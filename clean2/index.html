<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Barnlåten Städlista</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body { background:#f5f9fc; }
    input[type=checkbox] { transform:scale(1.3); margin-right:8px; }
    @media print {
      body {
        background: white !important;
        font-size: 12pt;
        line-height: 1.5;
        padding: 1cm;
      }
      .container {
        width: auto;
        margin: 0;
        padding: 0;
      }
      input[type=checkbox] {
        transform: scale(1.2);
        margin-right: 6px;
      }
      .no-print {
        display: none !important;
      }
      li {
        margin-bottom: 0.5em;
      }
    }
  </style>
</head>
<body class="container py-4">

<h1 class="mb-3">Barnlåten Städlista</h1>

<div class="no-print mb-3">
  <!-- Språkval borttaget: endast Svenska -->
  <div class="btn-group mb-2 me-2">
    <button class="btn btn-primary" id="vardag">Vardag</button>
    <button class="btn btn-outline-secondary" id="helg">Helg</button>
  </div>

  <div class="btn-group mb-2 me-2">
    <button class="btn btn-outline-danger" id="sjuk">Magsjuka</button>
  </div>

  <button id="clear" class="btn btn-outline-secondary mb-2">Rensa alla bockar</button>
</div>

<div id="list" class="bg-white p-3 rounded shadow-sm"></div>

<script>
  // Endast svenska
  const lang = 'sv';
  let mode = 'vardag';
  let sjuk = false;

  function fileName() {
    return sjuk ? `${mode}_sjuk_${lang}.md` : `${mode}_${lang}.md`;
  }

  function loadList() {
    const file = fileName();
    fetch(file)
      .then(r => r.ok ? r.text() : Promise.reject("not found"))
      .then(md => {
        md = md.replace(/\[\$\]/g, '<input type="checkbox">');
        const html = marked.parse(md, { gfm: true });
        document.getElementById('list').innerHTML = html;
        restoreChecks();
        enableAutoSave();
      })
      .catch(() => {
        document.getElementById('list').innerHTML =
          `<div class="alert alert-danger">Filen saknas: <b>${file}</b></div>`;
      });
  }

  function enableAutoSave() {
    document.querySelectorAll('input[type=checkbox]').forEach((cb, i) => {
      cb.addEventListener('change', () => {
        const key = `${fileName()}_${i}`;
        localStorage.setItem(key, cb.checked);
      });
    });
  }

  function restoreChecks() {
    document.querySelectorAll('input[type=checkbox]').forEach((cb, i) => {
      const key = `${fileName()}_${i}`;
      cb.checked = localStorage.getItem(key) === 'true';
    });
  }

  function resetButtons() {
    document.getElementById('vardag').className = mode === 'vardag' ? 'btn btn-primary' : 'btn btn-outline-secondary';
    document.getElementById('helg').className = mode === 'helg' ? 'btn btn-primary' : 'btn btn-outline-secondary';
    document.getElementById('sjuk').className = sjuk ? 'btn btn-danger' : 'btn btn-outline-danger';
  }

  ['vardag','helg','sjuk'].forEach(id => {
    document.getElementById(id).onclick = () => {
      if (id === 'vardag' || id === 'helg') mode = id;
      else if (id === 'sjuk') sjuk = !sjuk;
      resetButtons();
      loadList();
    };
  });

  document.getElementById('clear').onclick = () => {
    document.querySelectorAll('input[type=checkbox]').forEach(cb => cb.checked = false);
    Object.keys(localStorage).forEach(k => {
      if (k.startsWith(fileName())) localStorage.removeItem(k);
    });
  };

  resetButtons();
  loadList();
</script>

</body>
</html>
